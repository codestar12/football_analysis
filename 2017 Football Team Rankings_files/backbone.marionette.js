(function(e,t){e.Marionette=e.Mn=t(e,e.Backbone,e._)})(this,function(e,o,l){"use strict";(function(e,t){"use strict";var i=e.ChildViewContainer;e.ChildViewContainer=function(e,n){var t=function(e){this._views={};this._indexByModel={};this._indexByCustom={};this._updateLength();n.each(e,this.add,this)};n.extend(t.prototype,{add:function(e,t){var i=e.cid;this._views[i]=e;if(e.model){this._indexByModel[e.model.cid]=i}if(t){this._indexByCustom[t]=i}this._updateLength();return this},findByModel:function(e){return this.findByModelCid(e.cid)},findByModelCid:function(e){var t=this._indexByModel[e];return this.findByCid(t)},findByCustom:function(e){var t=this._indexByCustom[e];return this.findByCid(t)},findByIndex:function(e){return n.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(e){var i=e.cid;if(e.model){delete this._indexByModel[e.model.cid]}n.any(this._indexByCustom,function(e,t){if(e===i){delete this._indexByCustom[t];return true}},this);delete this._views[i];this._updateLength();return this},call:function(e){this.apply(e,n.tail(arguments))},apply:function(t,i){n.each(this._views,function(e){if(n.isFunction(e[t])){e[t].apply(e,i||[])}})},_updateLength:function(){this.length=n.size(this._views)}});var i=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck","reduce"];n.each(i,function(i){t.prototype[i]=function(){var e=n.values(this._views);var t=[e].concat(n.toArray(arguments));return n[i].apply(n,t)}});return t}(e,t);e.ChildViewContainer.VERSION="0.1.6";e.ChildViewContainer.noConflict=function(){e.ChildViewContainer=i;return this};return e.ChildViewContainer})(o,l);(function(i,s){"use strict";var e=i.Wreqr;var t=i.Wreqr={};i.Wreqr.VERSION="1.3.1";i.Wreqr.noConflict=function(){i.Wreqr=e;return this};t.Handlers=function(e,n){"use strict";var t=function(e){this.options=e;this._wreqrHandlers={};if(n.isFunction(this.initialize)){this.initialize(e)}};t.extend=e.Model.extend;n.extend(t.prototype,e.Events,{setHandlers:function(e){n.each(e,function(e,t){var i=null;if(n.isObject(e)&&!n.isFunction(e)){i=e.context;e=e.callback}this.setHandler(t,e,i)},this)},setHandler:function(e,t,i){var n={callback:t,context:i};this._wreqrHandlers[e]=n;this.trigger("handler:add",e,t,i)},hasHandler:function(e){return!!this._wreqrHandlers[e]},getHandler:function(e){var t=this._wreqrHandlers[e];if(!t){return}return function(){var e=Array.prototype.slice.apply(arguments);return t.callback.apply(t.context,e)}},removeHandler:function(e){delete this._wreqrHandlers[e]},removeAllHandlers:function(){this._wreqrHandlers={}}});return t}(i,s);t.CommandStorage=function(){"use strict";var e=function(e){this.options=e;this._commands={};if(s.isFunction(this.initialize)){this.initialize(e)}};s.extend(e.prototype,i.Events,{getCommands:function(e){var t=this._commands[e];if(!t){t={command:e,instances:[]};this._commands[e]=t}return t},addCommand:function(e,t){var i=this.getCommands(e);i.instances.push(t)},clearCommands:function(e){var t=this.getCommands(e);t.instances=[]}});return e}();t.Commands=function(i){"use strict";return i.Handlers.extend({storageType:i.CommandStorage,constructor:function(e){this.options=e||{};this._initializeStorage(this.options);this.on("handler:add",this._executeCommands,this);var t=Array.prototype.slice.call(arguments);i.Handlers.prototype.constructor.apply(this,t)},execute:function(e,t){e=arguments[0];t=Array.prototype.slice.call(arguments,1);if(this.hasHandler(e)){this.getHandler(e).apply(this,t)}else{this.storage.addCommand(e,t)}},_executeCommands:function(e,t,i){var n=this.storage.getCommands(e);s.each(n.instances,function(e){t.apply(i,e)});this.storage.clearCommands(e)},_initializeStorage:function(e){var t;var i=e.storageType||this.storageType;if(s.isFunction(i)){t=new i}else{t=i}this.storage=t}})}(t);t.RequestResponse=function(e){"use strict";return e.Handlers.extend({request:function(){var e=arguments[0];var t=Array.prototype.slice.call(arguments,1);if(this.hasHandler(e)){return this.getHandler(e).apply(this,t)}}})}(t);t.EventAggregator=function(e,t){"use strict";var i=function(){};i.extend=e.Model.extend;t.extend(i.prototype,e.Events);return i}(i,s);t.Channel=function(e){"use strict";var t=function(e){this.vent=new i.Wreqr.EventAggregator;this.reqres=new i.Wreqr.RequestResponse;this.commands=new i.Wreqr.Commands;this.channelName=e};s.extend(t.prototype,{reset:function(){this.vent.off();this.vent.stopListening();this.reqres.removeAllHandlers();this.commands.removeAllHandlers();return this},connectEvents:function(e,t){this._connect("vent",e,t);return this},connectCommands:function(e,t){this._connect("commands",e,t);return this},connectRequests:function(e,t){this._connect("reqres",e,t);return this},_connect:function(i,e,n){if(!e){return}n=n||this;var r=i==="vent"?"on":"setHandler";s.each(e,function(e,t){this[i][r](t,s.bind(e,n))},this)}});return t}(t);t.radio=function(i){"use strict";var e=function(){this._channels={};this.vent={};this.commands={};this.reqres={};this._proxyMethods()};s.extend(e.prototype,{channel:function(e){if(!e){throw new Error("Channel must receive a name")}return this._getChannel(e)},_getChannel:function(e){var t=this._channels[e];if(!t){t=new i.Channel(e);this._channels[e]=t}return t},_proxyMethods:function(){s.each(["vent","commands","reqres"],function(t){s.each(n[t],function(e){this[t][e]=r(this,t,e)},this)},this)}});var n={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]};var r=function(n,r,s){return function(e){var t=n._getChannel(e)[r];var i=Array.prototype.slice.call(arguments,1);return t[s].apply(t,i)}};return new e}(t);return i.Wreqr})(o,l);var t=e.Marionette;var i=e.Mn;var f=o.Marionette={};f.VERSION="2.4.1";f.noConflict=function(){e.Marionette=t;e.Mn=i;return this};o.Marionette=f;f.Deferred=o.$.Deferred;f.extend=o.Model.extend;f.isNodeAttached=function(e){return o.$.contains(document.documentElement,e)};f.mergeOptions=function(e,t){if(!e){return}l.extend(this,l.pick(e,t))};f.getOption=function(e,t){if(!e||!t){return}if(e.options&&e.options[t]!==undefined){return e.options[t]}else{return e[t]}};f.proxyGetOption=function(e){return f.getOption(this,e)};f._getValue=function(e,t,i){if(l.isFunction(e)){e=i?e.apply(t,i):e.call(t)}return e};f.normalizeMethods=function(e){return l.reduce(e,function(e,t,i){if(!l.isFunction(t)){t=this[t]}if(t){e[i]=t}return e},{},this)};f.normalizeUIString=function(e,t){return e.replace(/@ui\.[a-zA-Z_$0-9]*/g,function(e){return t[e.slice(4)]})};f.normalizeUIKeys=function(e,r){return l.reduce(e,function(e,t,i){var n=f.normalizeUIString(i,r);e[n]=t;return e},{})};f.normalizeUIValues=function(t,n,r){l.each(t,function(i,e){if(l.isString(i)){t[e]=f.normalizeUIString(i,n)}else if(l.isObject(i)&&l.isArray(r)){l.extend(i,f.normalizeUIValues(l.pick(i,r),n));l.each(r,function(e){var t=i[e];if(l.isString(t)){i[e]=f.normalizeUIString(t,n)}})}});return t};f.actAsCollection=function(e,n){var t=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];l.each(t,function(i){e[i]=function(){var e=l.values(l.result(this,n));var t=[e].concat(l.toArray(arguments));return l[i].apply(l,t)}})};var n=f.deprecate=function(e,t){if(l.isObject(e)){e=e.prev+" is going to be removed in the future. "+"Please use "+e.next+" instead."+(e.url?" See: "+e.url:"")}if((t===undefined||!t)&&!n._cache[e]){n._warn("Deprecation warning: "+e);n._cache[e]=true}};n._warn=typeof console!=="undefined"&&(console.warn||console.log)||function(){};n._cache={};f._triggerMethod=function(){var h=/(^|:)(\w)/gi;function a(e,t,i){return i.toUpperCase()}return function(e,t,i){var n=arguments.length<3;if(n){i=t;t=i[0]}var r="on"+t.replace(h,a);var s=e[r];var o;if(l.isFunction(s)){o=s.apply(e,n?l.rest(i):i)}if(l.isFunction(e.trigger)){if(n+i.length>1){e.trigger.apply(e,n?i:[t].concat(l.drop(i,0)))}else{e.trigger(t)}}return o}}();f.triggerMethod=function(e){return f._triggerMethod(this,arguments)};f.triggerMethodOn=function(e){var t=l.isFunction(e.triggerMethod)?e.triggerMethod:f.triggerMethod;return t.apply(e,l.rest(arguments))};f.MonitorDOMRefresh=function(e){function t(){e._isShown=true;n()}function i(){e._isRendered=true;n()}function n(){if(e._isShown&&e._isRendered&&f.isNodeAttached(e.el)){if(l.isFunction(e.triggerMethod)){e.triggerMethod("dom:refresh")}}}e.on({show:t,render:i})};(function(o){"use strict";function n(i,n,r,e){var t=e.split(/\s+/);l.each(t,function(e){var t=i[e];if(!t){throw new o.Error('Method "'+e+'" was configured as an event handler, but does not exist.')}i.listenTo(n,r,t)})}function r(e,t,i,n){e.listenTo(t,i,n)}function s(i,n,r,e){var t=e.split(/\s+/);l.each(t,function(e){var t=i[e];i.stopListening(n,r,t)})}function h(e,t,i,n){e.stopListening(t,i,n)}function a(i,n,e,r,s){if(!n||!e){return}if(!l.isObject(e)){throw new o.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"})}e=o._getValue(e,i);l.each(e,function(e,t){if(l.isFunction(e)){r(i,n,t,e)}else{s(i,n,t,e)}})}o.bindEntityEvents=function(e,t,i){a(e,t,i,r,n)};o.unbindEntityEvents=function(e,t,i){a(e,t,i,h,s)};o.proxyBindEntityEvents=function(e,t){return o.bindEntityEvents(this,e,t)};o.proxyUnbindEntityEvents=function(e,t){return o.unbindEntityEvents(this,e,t)}})(f);var r=["description","fileName","lineNumber","name","message","number"];f.Error=f.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+f.VERSION+"/",constructor:function(e,t){if(l.isObject(e)){t=e;e=t.message}else if(!t){t={}}var i=Error.call(this,e);l.extend(this,l.pick(i,r),l.pick(t,r));this.captureStackTrace();if(t.url){this.url=this.urlRoot+t.url}},captureStackTrace:function(){if(Error.captureStackTrace){Error.captureStackTrace(this,f.Error)}},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}});f.Error.extend=f.extend;f.Callbacks=function(){this._deferred=f.Deferred();this._callbacks=[]};l.extend(f.Callbacks.prototype,{add:function(t,i){var e=l.result(this._deferred,"promise");this._callbacks.push({cb:t,ctx:i});e.then(function(e){if(i){e.context=i}t.call(e.context,e.options)})},run:function(e,t){this._deferred.resolve({options:e,context:t})},reset:function(){var e=this._callbacks;this._deferred=f.Deferred();this._callbacks=[];l.each(e,function(e){this.add(e.cb,e.ctx)},this)}});f.Controller=function(e){this.options=e||{};if(l.isFunction(this.initialize)){this.initialize(this.options)}};f.Controller.extend=f.extend;l.extend(f.Controller.prototype,o.Events,{destroy:function(){f._triggerMethod(this,"before:destroy",arguments);f._triggerMethod(this,"destroy",arguments);this.stopListening();this.off();return this},triggerMethod:f.triggerMethod,mergeOptions:f.mergeOptions,getOption:f.proxyGetOption});f.Object=function(e){this.options=l.extend({},l.result(this,"options"),e);this.initialize.apply(this,arguments)};f.Object.extend=f.extend;l.extend(f.Object.prototype,o.Events,{initialize:function(){},destroy:function(){this.triggerMethod("before:destroy");this.triggerMethod("destroy");this.stopListening();return this},triggerMethod:f.triggerMethod,mergeOptions:f.mergeOptions,getOption:f.proxyGetOption,bindEntityEvents:f.proxyBindEntityEvents,unbindEntityEvents:f.proxyUnbindEntityEvents});f.Region=f.Object.extend({constructor:function(e){this.options=e||{};this.el=this.getOption("el");this.el=this.el instanceof o.$?this.el[0]:this.el;if(!this.el){throw new f.Error({name:"NoElError",message:'An "el" must be specified for a region.'})}this.$el=this.getEl(this.el);f.Object.call(this,e)},show:function(e,t){if(!this._ensureElement()){return}this._ensureViewIsIntact(e);var i=t||{};var n=e!==this.currentView;var r=!!i.preventDestroy;var s=!!i.forceShow;var o=!!this.currentView;var h=n&&!r;var a=n||s;if(o){this.triggerMethod("before:swapOut",this.currentView,this,t)}if(this.currentView){delete this.currentView._parent}if(h){this.empty()}else if(o&&a){this.currentView.off("destroy",this.empty,this)}if(a){e.once("destroy",this.empty,this);e.render();e._parent=this;if(o){this.triggerMethod("before:swap",e,this,t)}this.triggerMethod("before:show",e,this,t);f.triggerMethodOn(e,"before:show",e,this,t);if(o){this.triggerMethod("swapOut",this.currentView,this,t)}var l=f.isNodeAttached(this.el);var d=[];var u=i.triggerBeforeAttach||this.triggerBeforeAttach;var c=i.triggerAttach||this.triggerAttach;if(l&&u){d=this._displayedViews(e);this._triggerAttach(d,"before:")}this.attachHtml(e);this.currentView=e;if(l&&c){d=this._displayedViews(e);this._triggerAttach(d)}if(o){this.triggerMethod("swap",e,this,t)}this.triggerMethod("show",e,this,t);f.triggerMethodOn(e,"show",e,this,t);return this}return this},triggerBeforeAttach:true,triggerAttach:true,_triggerAttach:function(e,t){var i=(t||"")+"attach";l.each(e,function(e){f.triggerMethodOn(e,i,e,this)},this)},_displayedViews:function(e){return l.union([e],l.result(e,"_getNestedViews")||[])},_ensureElement:function(){if(!l.isObject(this.el)){this.$el=this.getEl(this.el);this.el=this.$el[0]}if(!this.$el||this.$el.length===0){if(this.getOption("allowMissingEl")){return false}else{throw new f.Error('An "el" '+this.$el.selector+" must exist in DOM")}}return true},_ensureViewIsIntact:function(e){if(!e){throw new f.Error({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."})}if(e.isDestroyed){throw new f.Error({name:"ViewDestroyedError",message:'View (cid: "'+e.cid+'") has already been destroyed and cannot be used.'})}},getEl:function(e){return o.$(e,f._getValue(this.options.parentEl,this))},attachHtml:function(e){this.$el.contents().detach();this.el.appendChild(e.el)},empty:function(e){var t=this.currentView;var i=f._getValue(e,"preventDestroy",this);if(!t){return}t.off("destroy",this.empty,this);this.triggerMethod("before:empty",t);if(!i){this._destroyView()}this.triggerMethod("empty",t);delete this.currentView;if(i){this.$el.contents().detach()}return this},_destroyView:function(){var e=this.currentView;if(e.destroy&&!e.isDestroyed){e.destroy()}else if(e.remove){e.remove();e.isDestroyed=true}},attachView:function(e){this.currentView=e;return this},hasView:function(){return!!this.currentView},reset:function(){this.empty();if(this.$el){this.el=this.$el.selector}delete this.$el;return this}},{buildRegion:function(e,t){if(l.isString(e)){return this._buildRegionFromSelector(e,t)}if(e.selector||e.el||e.regionClass){return this._buildRegionFromObject(e,t)}if(l.isFunction(e)){return this._buildRegionFromRegionClass(e)}throw new f.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})},_buildRegionFromSelector:function(e,t){return new t({el:e})},_buildRegionFromObject:function(e,t){var i=e.regionClass||t;var n=l.omit(e,"selector","regionClass");if(e.selector&&!n.el){n.el=e.selector}return new i(n)},_buildRegionFromRegionClass:function(e){return new e}});f.RegionManager=f.Controller.extend({constructor:function(e){this._regions={};this.length=0;f.Controller.call(this,e);this.addRegions(this.getOption("regions"))},addRegions:function(e,n){e=f._getValue(e,this,arguments);return l.reduce(e,function(e,t,i){if(l.isString(t)){t={selector:t}}if(t.selector){t=l.defaults({},t,n)}e[i]=this.addRegion(i,t);return e},{},this)},addRegion:function(e,t){var i;if(t instanceof f.Region){i=t}else{i=f.Region.buildRegion(t,f.Region)}this.triggerMethod("before:add:region",e,i);i._parent=this;this._store(e,i);this.triggerMethod("add:region",e,i);return i},get:function(e){return this._regions[e]},getRegions:function(){return l.clone(this._regions)},removeRegion:function(e){var t=this._regions[e];this._remove(e,t);return t},removeRegions:function(){var e=this.getRegions();l.each(this._regions,function(e,t){this._remove(t,e)},this);return e},emptyRegions:function(){var e=this.getRegions();l.invoke(e,"empty");return e},destroy:function(){this.removeRegions();return f.Controller.prototype.destroy.apply(this,arguments)},_store:function(e,t){if(!this._regions[e]){this.length++}this._regions[e]=t},_remove:function(e,t){this.triggerMethod("before:remove:region",e,t);t.empty();t.stopListening();delete t._parent;delete this._regions[e];this.length--;this.triggerMethod("remove:region",e,t)}});f.actAsCollection(f.RegionManager.prototype,"_regions");f.TemplateCache=function(e){this.templateId=e};l.extend(f.TemplateCache,{templateCaches:{},get:function(e,t){var i=this.templateCaches[e];if(!i){i=new f.TemplateCache(e);this.templateCaches[e]=i}return i.load(t)},clear:function(){var e;var t=l.toArray(arguments);var i=t.length;if(i>0){for(e=0;e<i;e++){delete this.templateCaches[t[e]]}}else{this.templateCaches={}}}});l.extend(f.TemplateCache.prototype,{load:function(e){if(this.compiledTemplate){return this.compiledTemplate}var t=this.loadTemplate(this.templateId,e);this.compiledTemplate=this.compileTemplate(t,e);return this.compiledTemplate},loadTemplate:function(e,t){var i=o.$(e).html();if(!i||i.length===0){throw new f.Error({name:"NoTemplateError",message:'Could not find template: "'+e+'"'})}return i},compileTemplate:function(e,t){return l.template(e,t)}});f.Renderer={render:function(e,t){if(!e){throw new f.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."})}var i=l.isFunction(e)?e:f.TemplateCache.get(e);return i(t)}};f.View=o.View.extend({isDestroyed:false,constructor:function(e){l.bindAll(this,"render");e=f._getValue(e,this);this.options=l.extend({},l.result(this,"options"),e);this._behaviors=f.Behaviors(this);o.View.call(this,this.options);f.MonitorDOMRefresh(this)},getTemplate:function(){return this.getOption("template")},serializeModel:function(e){return e.toJSON.apply(e,l.rest(arguments))},mixinTemplateHelpers:function(e){e=e||{};var t=this.getOption("templateHelpers");t=f._getValue(t,this);return l.extend(e,t)},normalizeUIKeys:function(e){var t=l.result(this,"_uiBindings");return f.normalizeUIKeys(e,t||l.result(this,"ui"))},normalizeUIValues:function(e,t){var i=l.result(this,"ui");var n=l.result(this,"_uiBindings");return f.normalizeUIValues(e,n||i,t)},configureTriggers:function(){if(!this.triggers){return}var e=this.normalizeUIKeys(l.result(this,"triggers"));return l.reduce(e,function(e,t,i){e[i]=this._buildViewTrigger(t);return e},{},this)},delegateEvents:function(e){this._delegateDOMEvents(e);this.bindEntityEvents(this.model,this.getOption("modelEvents"));this.bindEntityEvents(this.collection,this.getOption("collectionEvents"));l.each(this._behaviors,function(e){e.bindEntityEvents(this.model,e.getOption("modelEvents"));e.bindEntityEvents(this.collection,e.getOption("collectionEvents"))},this);return this},_delegateDOMEvents:function(e){var t=f._getValue(e||this.events,this);t=this.normalizeUIKeys(t);if(l.isUndefined(e)){this.events=t}var i={};var n=l.result(this,"behaviorEvents")||{};var r=this.configureTriggers();var s=l.result(this,"behaviorTriggers")||{};l.extend(i,n,t,r,s);o.View.prototype.delegateEvents.call(this,i)},undelegateEvents:function(){o.View.prototype.undelegateEvents.apply(this,arguments);this.unbindEntityEvents(this.model,this.getOption("modelEvents"));this.unbindEntityEvents(this.collection,this.getOption("collectionEvents"));l.each(this._behaviors,function(e){e.unbindEntityEvents(this.model,e.getOption("modelEvents"));e.unbindEntityEvents(this.collection,e.getOption("collectionEvents"))},this);return this},_ensureViewIsIntact:function(){if(this.isDestroyed){throw new f.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})}},destroy:function(){if(this.isDestroyed){return this}var e=l.toArray(arguments);this.triggerMethod.apply(this,["before:destroy"].concat(e));this.isDestroyed=true;this.triggerMethod.apply(this,["destroy"].concat(e));this.unbindUIElements();this.isRendered=false;this.remove();l.invoke(this._behaviors,"destroy",e);return this},bindUIElements:function(){this._bindUIElements();l.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(!this.ui){return}if(!this._uiBindings){this._uiBindings=this.ui}var e=l.result(this,"_uiBindings");this.ui={};l.each(e,function(e,t){this.ui[t]=this.$(e)},this)},unbindUIElements:function(){this._unbindUIElements();l.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){if(!this.ui||!this._uiBindings){return}l.each(this.ui,function(e,t){delete this.ui[t]},this);this.ui=this._uiBindings;delete this._uiBindings},_buildViewTrigger:function(e){var t=l.isObject(e);var i=l.defaults({},t?e:{},{preventDefault:true,stopPropagation:true});var n=t?i.event:e;return function(e){if(e){if(e.preventDefault&&i.preventDefault){e.preventDefault()}if(e.stopPropagation&&i.stopPropagation){e.stopPropagation()}}var t={view:this,model:this.model,collection:this.collection};this.triggerMethod(n,t)}},setElement:function(){var e=o.View.prototype.setElement.apply(this,arguments);l.invoke(this._behaviors,"proxyViewProperties",this);return e},triggerMethod:function(){var e=f._triggerMethod(this,arguments);this._triggerEventOnBehaviors(arguments);this._triggerEventOnParentLayout(arguments[0],l.rest(arguments));return e},_triggerEventOnBehaviors:function(e){var t=f._triggerMethod;var i=this._behaviors;for(var n=0,r=i&&i.length;n<r;n++){t(i[n],e)}},_triggerEventOnParentLayout:function(e,t){var i=this._parentLayoutView();if(!i){return}var n=f.getOption(i,"childViewEventPrefix");var r=n+":"+e;f._triggerMethod(i,[r,this].concat(t));var s=f.getOption(i,"childEvents");var o=i.normalizeMethods(s);if(!!o&&l.isFunction(o[e])){o[e].apply(i,[this].concat(t))}},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var e=this._getImmediateChildren();if(!e.length){return e}return l.reduce(e,function(e,t){if(!t._getNestedViews){return e}return e.concat(t._getNestedViews())},e)},_getAncestors:function(){var e=[];var t=this._parent;while(t){e.push(t);t=t._parent}return e},_parentLayoutView:function(){var e=this._getAncestors();return l.find(e,function(e){return e instanceof f.LayoutView})},normalizeMethods:f.normalizeMethods,mergeOptions:f.mergeOptions,getOption:f.proxyGetOption,bindEntityEvents:f.proxyBindEntityEvents,unbindEntityEvents:f.proxyUnbindEntityEvents});f.ItemView=f.View.extend({constructor:function(){f.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection){return{}}var e=[this.model||this.collection];if(arguments.length){e.push.apply(e,arguments)}if(this.model){return this.serializeModel.apply(this,e)}else{return{items:this.serializeCollection.apply(this,e)}}},serializeCollection:function(e){return e.toJSON.apply(e,l.rest(arguments))},render:function(){this._ensureViewIsIntact();this.triggerMethod("before:render",this);this._renderTemplate();this.isRendered=true;this.bindUIElements();this.triggerMethod("render",this);return this},_renderTemplate:function(){var e=this.getTemplate();if(e===false){return}if(!e){throw new f.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."})}var t=this.mixinTemplateHelpers(this.serializeData());var i=f.Renderer.render(e,t,this);this.attachElContent(i);return this},attachElContent:function(e){this.$el.html(e);return this}});f.CollectionView=f.View.extend({childViewEventPrefix:"childview",sort:true,constructor:function(e){this.once("render",this._initialEvents);this._initChildViewStorage();f.View.apply(this,arguments);this.on("show",this._onShowCalled);this.initRenderBuffer()},initRenderBuffer:function(){this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer();this.isBuffering=true},endBuffering:function(){this.isBuffering=false;this._triggerBeforeShowBufferedChildren();this.attachBuffer(this);this._triggerShowBufferedChildren();this.initRenderBuffer()},_triggerBeforeShowBufferedChildren:function(){if(this._isShown){l.each(this._bufferedChildren,l.partial(this._triggerMethodOnChild,"before:show"))}},_triggerShowBufferedChildren:function(){if(this._isShown){l.each(this._bufferedChildren,l.partial(this._triggerMethodOnChild,"show"));this._bufferedChildren=[]}},_triggerMethodOnChild:function(e,t){f.triggerMethodOn(t,e)},_initialEvents:function(){if(this.collection){this.listenTo(this.collection,"add",this._onCollectionAdd);this.listenTo(this.collection,"remove",this._onCollectionRemove);this.listenTo(this.collection,"reset",this.render);if(this.getOption("sort")){this.listenTo(this.collection,"sort",this._sortViews)}}},_onCollectionAdd:function(e,t,i){var n;if(i.at!==undefined){n=i.at}else{n=l.indexOf(this._filteredSortedModels(),e)}if(this._shouldAddChild(e,n)){this.destroyEmptyView();var r=this.getChildView(e);this.addChild(e,r,n)}},_onCollectionRemove:function(e){var t=this.children.findByModel(e);this.removeChildView(t);this.checkEmpty()},_onShowCalled:function(){this.children.each(l.partial(this._triggerMethodOnChild,"show"))},render:function(){this._ensureViewIsIntact();this.triggerMethod("before:render",this);this._renderChildren();this.isRendered=true;this.triggerMethod("render",this);return this},reorder:function(){var t=this.children;var e=this._filteredSortedModels();var i=l.find(e,function(e){return!t.findByModel(e)});if(i){this.render()}else{var n=l.map(e,function(e){return t.findByModel(e).el});this.triggerMethod("before:reorder");this._appendReorderedChildren(n);this.triggerMethod("reorder")}},resortView:function(){if(f.getOption(this,"reorderOnSort")){this.reorder()}else{this.render()}},_sortViews:function(){var e=this._filteredSortedModels();var t=l.find(e,function(e,t){var i=this.children.findByModel(e);return!i||i._index!==t},this);if(t){this.resortView()}},_emptyViewIndex:-1,_appendReorderedChildren:function(e){this.$el.append(e)},_renderChildren:function(){this.destroyEmptyView();this.destroyChildren();if(this.isEmpty(this.collection)){this.showEmptyView()}else{this.triggerMethod("before:render:collection",this);this.startBuffering();this.showCollection();this.endBuffering();this.triggerMethod("render:collection",this);if(this.children.isEmpty()){this.showEmptyView()}}},showCollection:function(){var i;var e=this._filteredSortedModels();l.each(e,function(e,t){i=this.getChildView(e);this.addChild(e,i,t)},this)},_filteredSortedModels:function(){var e;var t=this.getViewComparator();if(t){if(l.isString(t)||t.length===1){e=this.collection.sortBy(t,this)}else{e=l.clone(this.collection.models).sort(l.bind(t,this))}}else{e=this.collection.models}if(this.getOption("filter")){e=l.filter(e,function(e,t){return this._shouldAddChild(e,t)},this)}return e},showEmptyView:function(){var e=this.getEmptyView();if(e&&!this._showingEmptyView){this.triggerMethod("before:render:empty");this._showingEmptyView=true;var t=new o.Model;this.addEmptyView(t,e);this.triggerMethod("render:empty")}},destroyEmptyView:function(){if(this._showingEmptyView){this.triggerMethod("before:remove:empty");this.destroyChildren();delete this._showingEmptyView;this.triggerMethod("remove:empty")}},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(e,t){var i=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");if(l.isFunction(i)){i=i.call(this,e,this._emptyViewIndex)}var n=this.buildChildView(e,t,i);n._parent=this;this.proxyChildEvents(n);if(this._isShown){f.triggerMethodOn(n,"before:show")}this.children.add(n);this.renderChildView(n,this._emptyViewIndex);if(this._isShown){f.triggerMethodOn(n,"show")}},getChildView:function(e){var t=this.getOption("childView");if(!t){throw new f.Error({name:"NoChildViewError",message:'A "childView" must be specified'})}return t},addChild:function(e,t,i){var n=this.getOption("childViewOptions");n=f._getValue(n,this,[e,i]);var r=this.buildChildView(e,t,n);this._updateIndices(r,true,i);this._addChildView(r,i);r._parent=this;return r},_updateIndices:function(t,i,e){if(!this.getOption("sort")){return}if(i){t._index=e}this.children.each(function(e){if(e._index>=t._index){e._index+=i?1:-1}})},_addChildView:function(e,t){this.proxyChildEvents(e);this.triggerMethod("before:add:child",e);if(this._isShown&&!this.isBuffering){f.triggerMethodOn(e,"before:show")}this.children.add(e);this.renderChildView(e,t);if(this._isShown&&!this.isBuffering){f.triggerMethodOn(e,"show")}this.triggerMethod("add:child",e)},renderChildView:function(e,t){e.render();this.attachHtml(this,e,t);return e},buildChildView:function(e,t,i){var n=l.extend({model:e},i);return new t(n)},removeChildView:function(e){if(e){this.triggerMethod("before:remove:child",e);if(e.destroy){e.destroy()}else if(e.remove){e.remove()}delete e._parent;this.stopListening(e);this.children.remove(e);this.triggerMethod("remove:child",e);this._updateIndices(e,false)}return e},isEmpty:function(){return!this.collection||this.collection.length===0},checkEmpty:function(){if(this.isEmpty(this.collection)){this.showEmptyView()}},attachBuffer:function(e){e.$el.append(this._createBuffer(e))},_createBuffer:function(e){var t=document.createDocumentFragment();l.each(e._bufferedChildren,function(e){t.appendChild(e.el)});return t},attachHtml:function(e,t,i){if(e.isBuffering){e._bufferedChildren.splice(i,0,t)}else{if(!e._insertBefore(t,i)){e._insertAfter(t)}}},_insertBefore:function(e,t){var i;var n=this.getOption("sort")&&t<this.children.length-1;if(n){i=this.children.find(function(e){return e._index===t+1})}if(i){i.$el.before(e.el);return true}return false},_insertAfter:function(e){this.$el.append(e.el)},_initChildViewStorage:function(){this.children=new o.ChildViewContainer},destroy:function(){if(this.isDestroyed){return this}this.triggerMethod("before:destroy:collection");this.destroyChildren();this.triggerMethod("destroy:collection");return f.View.prototype.destroy.apply(this,arguments)},destroyChildren:function(){var e=this.children.map(l.identity);this.children.each(this.removeChildView,this);this.checkEmpty();return e},_shouldAddChild:function(e,t){var i=this.getOption("filter");return!l.isFunction(i)||i.call(this,e,t,this.collection)},proxyChildEvents:function(n){var r=this.getOption("childViewEventPrefix");this.listenTo(n,"all",function(){var e=l.toArray(arguments);var t=e[0];var i=this.normalizeMethods(l.result(this,"childEvents"));e[0]=r+":"+t;e.splice(1,0,n);if(typeof i!=="undefined"&&l.isFunction(i[t])){i[t].apply(this,e.slice(1))}this.triggerMethod.apply(this,e)})},_getImmediateChildren:function(){return l.values(this.children._views)},getViewComparator:function(){return this.getOption("viewComparator")}});f.CompositeView=f.CollectionView.extend({constructor:function(){f.CollectionView.apply(this,arguments)},_initialEvents:function(){if(this.collection){this.listenTo(this.collection,"add",this._onCollectionAdd);this.listenTo(this.collection,"remove",this._onCollectionRemove);this.listenTo(this.collection,"reset",this._renderChildren);if(this.getOption("sort")){this.listenTo(this.collection,"sort",this._sortViews)}}},getChildView:function(e){var t=this.getOption("childView")||this.constructor;return t},serializeData:function(){var e={};if(this.model){e=l.partial(this.serializeModel,this.model).apply(this,arguments)}return e},render:function(){this._ensureViewIsIntact();this._isRendering=true;this.resetChildViewContainer();this.triggerMethod("before:render",this);this._renderTemplate();this._renderChildren();this._isRendering=false;this.isRendered=true;this.triggerMethod("render",this);return this},_renderChildren:function(){if(this.isRendered||this._isRendering){f.CollectionView.prototype._renderChildren.call(this)}},_renderTemplate:function(){var e={};e=this.serializeData();e=this.mixinTemplateHelpers(e);this.triggerMethod("before:render:template");var t=this.getTemplate();var i=f.Renderer.render(t,e,this);this.attachElContent(i);this.bindUIElements();this.triggerMethod("render:template")},attachElContent:function(e){this.$el.html(e);return this},attachBuffer:function(e){var t=this.getChildViewContainer(e);t.append(this._createBuffer(e))},_insertAfter:function(e){var t=this.getChildViewContainer(this,e);t.append(e.el)},_appendReorderedChildren:function(e){var t=this.getChildViewContainer(this);t.append(e)},getChildViewContainer:function(e,t){if("$childViewContainer"in e){return e.$childViewContainer}var i;var n=f.getOption(e,"childViewContainer");if(n){var r=f._getValue(n,e);if(r.charAt(0)==="@"&&e.ui){i=e.ui[r.substr(4)]}else{i=e.$(r)}if(i.length<=0){throw new f.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+e.childViewContainer})}}else{i=e.$el}e.$childViewContainer=i;return i},resetChildViewContainer:function(){if(this.$childViewContainer){delete this.$childViewContainer}}});f.LayoutView=f.ItemView.extend({regionClass:f.Region,options:{destroyImmediate:false},childViewEventPrefix:"childview",constructor:function(e){e=e||{};this._firstRender=true;this._initializeRegions(e);f.ItemView.call(this,e)},render:function(){this._ensureViewIsIntact();if(this._firstRender){this._firstRender=false}else{this._reInitializeRegions()}return f.ItemView.prototype.render.apply(this,arguments)},destroy:function(){if(this.isDestroyed){return this}if(this.getOption("destroyImmediate")===true){this.$el.remove()}this.regionManager.destroy();return f.ItemView.prototype.destroy.apply(this,arguments)},showChildView:function(e,t){return this.getRegion(e).show(t)},getChildView:function(e){return this.getRegion(e).currentView},addRegion:function(e,t){var i={};i[e]=t;return this._buildRegions(i)[e]},addRegions:function(e){this.regions=l.extend({},this.regions,e);return this._buildRegions(e)},removeRegion:function(e){delete this.regions[e];return this.regionManager.removeRegion(e)},getRegion:function(e){return this.regionManager.get(e)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(e){var t={regionClass:this.getOption("regionClass"),parentEl:l.partial(l.result,this,"el")};return this.regionManager.addRegions(e,t)},_initializeRegions:function(e){var t;this._initRegionManager();t=f._getValue(this.regions,this,[e])||{};var i=this.getOption.call(e,"regions");i=f._getValue(i,this,[e]);l.extend(t,i);t=this.normalizeUIValues(t,["selector","el"]);this.addRegions(t)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},getRegionManager:function(){return new f.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager();this.regionManager._parent=this;this.listenTo(this.regionManager,"before:add:region",function(e){this.triggerMethod("before:add:region",e)});this.listenTo(this.regionManager,"add:region",function(e,t){this[e]=t;this.triggerMethod("add:region",e,t)});this.listenTo(this.regionManager,"before:remove:region",function(e){this.triggerMethod("before:remove:region",e)});this.listenTo(this.regionManager,"remove:region",function(e,t){delete this[e];this.triggerMethod("remove:region",e,t)})},_getImmediateChildren:function(){return l.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}});f.Behavior=f.Object.extend({constructor:function(e,t){this.view=t;this.defaults=l.result(this,"defaults")||{};this.options=l.extend({},this.defaults,e);this.ui=l.extend({},l.result(t,"ui"),l.result(this,"ui"));f.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){this.stopListening();return this},proxyViewProperties:function(e){this.$el=e.$el;this.el=e.el}});f.Behaviors=function(n,u){var c=/^(\S+)\s*(.*)$/;function o(e,t){if(!u.isObject(e.behaviors)){return{}}t=o.parseBehaviors(e,t||u.result(e,"behaviors"));o.wrap(e,t,u.keys(r));return t}var r={behaviorTriggers:function(e,t){var i=new s(this,t);return i.buildBehaviorTriggers()},behaviorEvents:function(e,t){var i={};u.each(t,function(h,a){var l={};var e=u.clone(u.result(h,"events"))||{};e=n.normalizeUIKeys(e,f(h));var d=0;u.each(e,function(e,t){var i=t.match(c);var n=i[1]+"."+[this.cid,a,d++," "].join("");var r=i[2];var s=n+r;var o=u.isFunction(e)?e:h[e];l[s]=u.bind(o,h)},this);i=u.extend(i,l)},this);return i}};u.extend(o,{behaviorsLookup:function(){throw new n.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"})},getBehaviorClass:function(e,t){if(e.behaviorClass){return e.behaviorClass}return n._getValue(o.behaviorsLookup,this,[e,t])[t]},parseBehaviors:function(s,e){return u.chain(e).map(function(e,t){var i=o.getBehaviorClass(e,t);var n=new i(e,s);var r=o.parseBehaviors(s,u.result(n,"behaviors"));return[n].concat(r)}).flatten().value()},wrap:function(t,i,e){u.each(e,function(e){t[e]=u.partial(r[e],t[e],i)})}});function s(e,t){this._view=e;this._behaviors=t;this._triggers={}}u.extend(s.prototype,{buildBehaviorTriggers:function(){u.each(this._behaviors,this._buildTriggerHandlersForBehavior,this);return this._triggers},_buildTriggerHandlersForBehavior:function(e,t){var i=u.clone(u.result(e,"triggers"))||{};i=n.normalizeUIKeys(i,f(e));u.each(i,u.bind(this._setHandlerForBehavior,this,e,t))},_setHandlerForBehavior:function(e,t,i,n){var r=n.replace(/^\S+/,function(e){return e+"."+"behaviortriggers"+t});this._triggers[r]=this._view._buildViewTrigger(i)}});function f(e){return e._uiBindings||e.ui}return o}(f,l);f.AppRouter=o.Router.extend({constructor:function(e){this.options=e||{};o.Router.apply(this,arguments);var t=this.getOption("appRoutes");var i=this._getController();this.processAppRoutes(i,t);this.on("route",this._processOnRoute,this)},appRoute:function(e,t){var i=this._getController();this._addAppRoute(i,e,t)},_processOnRoute:function(e,t){if(l.isFunction(this.onRoute)){var i=l.invert(this.getOption("appRoutes"))[e];this.onRoute(e,i,t)}},processAppRoutes:function(t,i){if(!i){return}var e=l.keys(i).reverse();l.each(e,function(e){this._addAppRoute(t,e,i[e])},this)},_getController:function(){return this.getOption("controller")},_addAppRoute:function(e,t,i){var n=e[i];if(!n){throw new f.Error('Method "'+i+'" was not found on the controller')}this.route(t,i,l.bind(n,e))},mergeOptions:f.mergeOptions,getOption:f.proxyGetOption,triggerMethod:f.triggerMethod,bindEntityEvents:f.proxyBindEntityEvents,unbindEntityEvents:f.proxyUnbindEntityEvents});f.Application=f.Object.extend({constructor:function(e){this._initializeRegions(e);this._initCallbacks=new f.Callbacks;this.submodules={};l.extend(this,e);this._initChannel();f.Object.call(this,e)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("before:start",e);this._initCallbacks.run(e,this);this.triggerMethod("start",e)},addRegions:function(e){return this._regionManager.addRegions(e)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(e){return this._regionManager.removeRegion(e)},getRegion:function(e){return this._regionManager.get(e)},getRegions:function(){return this._regionManager.getRegions()},module:function(e,t){var i=f.Module.getClass(t);var n=l.toArray(arguments);n.unshift(this);return i.create.apply(i,n)},getRegionManager:function(){return new f.RegionManager},_initializeRegions:function(e){var t=l.isFunction(this.regions)?this.regions(e):this.regions||{};this._initRegionManager();var i=f.getOption(e,"regions");if(l.isFunction(i)){i=i.call(this,e)}l.extend(t,i);this.addRegions(t);return this},_initRegionManager:function(){this._regionManager=this.getRegionManager();this._regionManager._parent=this;this.listenTo(this._regionManager,"before:add:region",function(){f._triggerMethod(this,"before:add:region",arguments)});this.listenTo(this._regionManager,"add:region",function(e,t){this[e]=t;f._triggerMethod(this,"add:region",arguments)});this.listenTo(this._regionManager,"before:remove:region",function(){f._triggerMethod(this,"before:remove:region",arguments)});this.listenTo(this._regionManager,"remove:region",function(e){delete this[e];f._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=l.result(this,"channelName")||"global";this.channel=l.result(this,"channel")||o.Wreqr.radio.channel(this.channelName);this.vent=l.result(this,"vent")||this.channel.vent;this.commands=l.result(this,"commands")||this.channel.commands;this.reqres=l.result(this,"reqres")||this.channel.reqres}});f.Module=function(e,t,i){this.moduleName=e;this.options=l.extend({},this.options,i);this.initialize=i.initialize||this.initialize;this.submodules={};this._setupInitializersAndFinalizers();this.app=t;if(l.isFunction(this.initialize)){this.initialize(e,t,this.options)}};f.Module.extend=f.extend;l.extend(f.Module.prototype,o.Events,{startWithParent:true,initialize:function(){},addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(t){if(this._isInitialized){return}l.each(this.submodules,function(e){if(e.startWithParent){e.start(t)}});this.triggerMethod("before:start",t);this._initializerCallbacks.run(t,this);this._isInitialized=true;this.triggerMethod("start",t)},stop:function(){if(!this._isInitialized){return}this._isInitialized=false;this.triggerMethod("before:stop");l.invoke(this.submodules,"stop");this._finalizerCallbacks.run(undefined,this);this._initializerCallbacks.reset();this._finalizerCallbacks.reset();this.triggerMethod("stop")},addDefinition:function(e,t){this._runModuleDefinition(e,t)},_runModuleDefinition:function(e,t){if(!e){return}var i=l.flatten([this,this.app,o,f,o.$,l,t]);e.apply(this,i)},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new f.Callbacks;this._finalizerCallbacks=new f.Callbacks},triggerMethod:f.triggerMethod});l.extend(f.Module,{create:function(n,e,r){var s=n;var o=l.drop(arguments,3);e=e.split(".");var t=e.length;var h=[];h[t-1]=r;l.each(e,function(e,t){var i=s;s=this._getModule(i,e,n,r);this._addModuleDefinition(i,s,h[t],o)},this);return s},_getModule:function(e,t,i,n,r){var s=l.extend({},n);var o=this.getClass(n);var h=e[t];if(!h){h=new o(t,i,s);e[t]=h;e.submodules[t]=h}return h},getClass:function(e){var t=f.Module;if(!e){return t}if(e.prototype instanceof t){return e}return e.moduleClass||t},_addModuleDefinition:function(e,t,i,n){var r=this._getDefine(i);var s=this._getStartWithParent(i,t);if(r){t.addDefinition(r,n)}this._addStartWithParent(e,t,s)},_getStartWithParent:function(e,t){var i;if(l.isFunction(e)&&e.prototype instanceof f.Module){i=t.constructor.prototype.startWithParent;return l.isUndefined(i)?true:i}if(l.isObject(e)){i=e.startWithParent;return l.isUndefined(i)?true:i}return true},_getDefine:function(e){if(l.isFunction(e)&&!(e.prototype instanceof f.Module)){return e}if(l.isObject(e)){return e.define}return null},_addStartWithParent:function(e,t,i){t.startWithParent=t.startWithParent&&i;if(!t.startWithParent||!!t.startWithParentIsConfigured){return}t.startWithParentIsConfigured=true;e.addInitializer(function(e){if(t.startWithParent){t.start(e)}})}});return f});