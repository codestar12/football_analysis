define(["version!fly/libs/backbone","jquery","libs/debug","version!fly/components/base","version!fly/libs/underscore","libs/backbone.marionette","text!templates/special-feature/saag/scores.html","text!templates/special-feature/saag/mlb/baserunners.html","translations/core","utils/commonFunctions"],function(e,L,a,s,t,r,n,i,o,g){a=a.init("scores");a.enable();a.log("scores");SaagGame=e.Model.extend({defaults:{id:"",abbr:"",label:"",arena:"",game_league:"",game_mode:"",gametracker_url:"",hometeam:{},awayteam:{},status:"",scheduled_date_time:"",scheduled_epoch:"",odds_current_total:"",odds_current_spread:"",odds_home_current_money:"",enhanced:"Yes",recap:"No",preview:"No",tv:"",season_type:"",time_remaining:"",current_quarter:"",current_period:"",current_inning:"",current_outs:"0",inning_status:"",homescore_total:"0",homescore_last_total:"0",awayscore_total:"0",awayscore_last_total:"0",homescore_runs:"0",homescore_last_runs:"0",awayscore_runs:"0",awayscore_last_runs:"0",homescore_changed:false,awayscore_changed:false,field_position_team_in_possession:"",runners_on_base:"",cstvlink:"",tournament:"",view:"desktop"},initialize:function(){a.log(this.get("status"));this.setView();this.setGameLeagueArena();this.setGameMode();this.setGameTrackerUrl()},setView:function(){this.set({view:window.SportsPageVars.device})},setGameLeagueArena:function(){var e=this.get("abbr"),a=e.split("_"),s=a.shift(),t=s.toLowerCase();switch(s){case"NFL":case"NBA":case"MLB":case"NHL":s=s.toLowerCase();break;case"NCAAF":s="collegefootball";break;case"NCAAB":s="collegebasketball";break}this.set({game_league:s});this.set({arena:t})},setGameMode:function(){var e="pregame";var a=this.get("status");switch(a){case"SCHEDULED":case"RESCHEDULED":e="pregame";break;case"INPROGRESS":case"DELAYED":case"HALFTIME":e="ingame";break;case"FINAL":case"POSTPONED":case"CANCELLED":e="postgame";break}this.set({game_mode:e})},setGameTrackerUrl:function(){var e=this.get("game_mode"),a=this.get("abbr"),s=this.get("enhanced")=="Yes",t=this.get("game_league"),r="/"+t+"/gametracker/"+a+"/";if(t!="nhl"){if(s){r="/"+g.getHighlanderLeagueForRouting(t)+"/gametracker/";switch(e){case"pregame":if(this.get("preview")=="Yes"){r+="preview"}break;case"postgame":if(this.get("recap")=="Yes"){r+="recap"}break;default:r+="live"}r+="/"+a+"/"}else{if(L.inArray(t,["collegebasketball","collegefootball"])>=0&&e=="ingame"){var n=this.get("cstvlink");r=n!=""?n:r}}}this.set({gametracker_url:r})}});SaagGamesCollection=e.Collection.extend({model:SaagGame});SaagGameView=r.ItemView.extend({template:n,tagName:"div",modelEvents:{change:"modelChanged","change:status":"statusChanged"},statusChanged:function(){this.model.setGameMode()},modelChanged:function(){var e=this;var a=this.model.changedAttributes();if(this.model.get("homescore_changed")==false&&this.model.get("awayscore_changed")==false){this.render()}else{if(a.homescore_changed==true||a.awayscore_changed==true){this.render();setTimeout(function(){e.model.set({homescore_changed:false,awayscore_changed:false})},5e3)}}L(window).resize()},onRender:function(){},onShow:function(){},templateHelpers:{formatScorecardClass:function(){var e=this.game_mode,a=this.arena,s=a;switch(e){case"pregame":s+=" pre-game";break;case"postgame":s+=" post-game";break}return s},formatTeamWinnerClass:function(e){var a=this.game_mode,s=this.arena,t=s=="mlb"?this.homescore_runs:this.homescore_total,r=s=="mlb"?this.awayscore_runs:this.awayscore_total;if(a=="postgame"){if(e=="away"){return parseInt(r)>parseInt(t)?"winner":""}else{return parseInt(r)<parseInt(t)?"winner":""}}return""},formatTeamPossessionClass:function(e){var a=this.arena,s=this.status;if(s.toLowerCase()=="inprogress"){switch(a){case"nfl":case"ncaaf":var t=this.field_position_team_in_possession,r=e=="home"?this.hometeam.id:this.awayteam.id;return t==r?"marker":"";case"mlb":var n=this.inning_status,i=n.toLowerCase();if(L.inArray(i,["top","bottom"])!=-1){return e=="away"&&i=="top"||e=="home"&&i=="bottom"?"marker":""}}}return""},formatTeam:function(e){var a=this.arena,s=this.game_league,t=this.game_mode,r=this.tournament,n=this.season_type,i=e=="home"?this.hometeam:this.awayteam,o=typeof i.rank!="undefined"?i.rank:"",c=L.inArray(a,["mlb","nba"])!=-1?true:false,l=g.getTeamLogo(s,i.abbr,c),h="";if(r!=""||n.toLowerCase()=="postseason"&&L.inArray(a,["nba"])!=-1){o=typeof i.seed!="undefined"?i.seed:""}h+='<div class="logo"><img src="'+l+'" alt=""></div>';h+='<div class="team">';if(o!=""){h+='<span class="rank">'+o+"</span>"}h+=i.abbr;h+="</div>";var m=this.awayscore_changed,d=this.homescore_changed;h+='<div class="score">';if(t=="pregame"){if(e=="away"){h+=this.odds_current_total!=""?"o"+this.odds_current_total:""}else{if(L.inArray(a,["mlb","nhl"])!=-1){h+=this.odds_home_current_money!=""?parseInt(this.odds_home_current_money)>0?"+"+this.odds_home_current_money:this.odds_home_current_money:""}else{h+=this.odds_current_spread!=""?parseInt(this.odds_current_spread)>0?"+"+this.odds_current_spread:this.odds_current_spread:""}}}else{if(a=="mlb"){var u=e=="away"?this.awayscore_last_runs:this.homescore_last_runs,_=e=="away"?this.awayscore_runs:this.homescore_runs}else{var u=e=="away"?this.awayscore_last_total:this.homescore_last_total,_=e=="away"?this.awayscore_total:this.homescore_total}h+='<div class="in-game-score">';if(u!="0"&&(e=="away"&&m||e=="home"&&d)){h+='<span class="old fade-out-up">'+u+"</span>";h+='<span class="current fade-in-up">'+_+"</span>"}else{h+=_}h+="</div>"}h+="</div>";return h},insertAdditionalGameInfo:function(){var e=this.arena,a=this.game_mode,s="";if(e=="mlb"&&a=="ingame"){s=_.template(i)(this)}return s},formatCurrentStatus:function(){var e=this.arena,a=this.game_mode,s=this.status,t=this.season_type,r=0,n=4,i="";switch(a){case"pregame":var o=false,c=new Date,l=new Date(0);l.setUTCSeconds(this.scheduled_epoch);var h=l.getHours(),m=l.getMinutes(),d=h<12?"A":"P";o=c.toDateString()==l.toDateString();if(m<10){m="0"+m}if(h>12){h=h-12}i+='<span class="status-left">';if(!o){var u={0:"Sun",1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat"},_=l.getDay(),g=u[_];i+=g.toUpperCase()+" "}i+=h+":"+m+d;i+="</span>";var f=this.tv;if(f!=""){i+='<span class="status-right">'+f+"</span>"}break;case"ingame":var p=false,b=n/2,f=this.tv,w=this.time_remaining,v=this.inning_status,y=v.toLowerCase(),k=L.inArray(w,["0.0","0:00","00:00","00.0","0"])!=-1;if(s.toLowerCase()=="delayed"){i+='<span class="status-left">';i+=s}else{switch(e){case"mlb":n=9;r=this.current_inning;if(L.inArray(y,["top","bottom"])!=-1){i+='<div class="icon-moon-caret-';i+=(y=="top"?"up":"down")+'"></div>'}break;case"ncaab":n=2;r=this.current_period;b=n/2;break;case"nhl":n=3;r=this.current_period;break;default:r=this.current_quarter}i+='<span class="status-left">';p=r>n;if(e=="mlb"){p=false;if(L.inArray(y,["middle","end"])!=-1){i+=v+" "}}if(p){var C=r-n;if(e=="nhl"&&t.toLowerCase()!="postseason"&&C>1){i+="SO"}else{i+=k&&e!="ncaaf"?"End ":"";i+=(parseInt(C)>1?C:"")+"OT"}if(e!="ncaaf"){i+=k==false&&w!=""?" "+w:""}}else{if(L.inArray(e,["nba","ncaab","nfl","ncaaf"])!=-1&&r==b&&k){i+="Halftime"}else{i+=k?"End ":"";i+=this.getOrdinal(r,true);i+=k==false&&w!=""?" "+w:""}}if(e=="mlb"&&L.inArray(y,["middle","end"])==-1){var A=parseInt(this.current_outs);i+=",&nbsp;"+A+" Out"+(A!==1?"s":"")}}i+="</span>";if(f!=""){i+='<span class="status-right">'+f+"</span>"}break;case"postgame":switch(e){case"mlb":n=9;r=this.current_inning;break;case"ncaab":n=2;r=this.current_period;break;case"nhl":n=3;r=this.current_period;break;default:r=this.current_quarter}i+='<span class="status-left">';i+=s;if(s.toLowerCase()=="final"&&r!=n){i+="/";if(e=="mlb"){i+=r}else{var C=parseInt(r)-parseInt(n);if(e=="nhl"&&t.toLowerCase()!="postseason"&&C>1){i+="SO"}else{i+=C>1?C:"";i+="OT"}}}i+="</span>";break}return i},getOrdinal:function(e,a){var s=[,"st","nd","rd"];return(a?e:"")+(s[((e=Math.abs(e%100))-20)%10]||s[e]||"th")}}});SaagGameRegion=r.Region.extend({el:null,initialize:function(e){this.el=e.el}});return null});