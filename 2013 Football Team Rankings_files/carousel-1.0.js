define(["jquery","version!fly/utils/string-helper","version!fly/components/base"],function(s,i){var n=s.support.touch?"vclick":"click";s.widget("fly.carousel",s.fly.base,{options:{currentSlide:0,numOfVisibleSlides:1,incrementAmount:1,slideHeight:null,slideWidth:null,hidePreviousOnFirstSlide:false,updatePagination:false,pageUrlAttribute:"page-location",autoplayDelay:6e3,autoplayPauseOnHover:true,autoplayPauseOnBlur:true,classSelected:"selected",classActive:"active",classFocus:"focused",transitionType:"fade",transitionDuration:400,transitionEasing:"linear"},transitionTypes:{fade:{init:function(){var e=this.options;this.vertical=false;this.items.slides.$elements.not("."+e.classSelected).hide()},showSlide:function(e){var t=this.options;s(this.items.slides.$elements[t.currentSlide]).fadeOut(t.transitionDuration,t.transitionEasing);s(this.items.slides.$elements[e]).fadeIn(t.transitionDuration,t.transitionEasing)}},slideHorizontal:{init:function(){var e=this.options;this.items.canvas.$element.css("left",-this.slideWidth*e.currentSlide)},showSlide:function(e){var t=this.options;this.items.canvas.$element.animate({left:-this.slideWidth*e},t.transitionDuration,t.transitionEasing)}},slideHorizontalInfinite:{init:function(){var e=this.options;this.infinite=true;this.items.canvas.$element.css("left","0");if(e.slideWidth&&e.incrementAmount==-1){e.incrementAmount=Math.floor(this.items.container.$element.width()/parseInt(e.slideWidth))}},showSlide:function(t){var e=this.options;if(t>0){this.items.canvas.$element.animate({left:-this.slideWidth*t},e.transitionDuration,e.transitionEasing,function(){for(var e=0;e<t;e++){this.items.canvas.$element.append(this.items.slides.$elements[e])}this.items.canvas.$element.css("left","0");this.items.slides.$elements=s(this.items.slides.selector,this.$element)}.bind(this))}else if(t<0){for(var i=this.items.slides.$elements.length-1;i>=this.items.slides.$elements.length+t;i--){this.items.canvas.$element.prepend(this.items.slides.$elements[i])}this.items.canvas.$element.css("left",this.slideWidth*t+"px");this.items.slides.$elements=s(this.items.slides.selector,this.$element);this.items.canvas.$element.animate({left:"0"},e.transitionDuration,e.transitionEasing)}}},slideVertical:{init:function(){var e=this.options;this.vertical=true;this.items.canvas.$element.css("top",-e.slideHeight*e.currentSlide)},showSlide:function(e){var t=this.options;this.items.canvas.$element.animate({top:-t.slideHeight*e},t.transitionDuration,t.transitionEasing)}},slideVerticalInfinite:{init:function(){var e=this.options;this.infinite=true;this.vertical=true;this.items.canvas.$element.css("top",-e.slideHeight*e.currentSlide)},showSlide:function(t){var e=this.options;if(t>0){this.items.canvas.$element.animate({top:-e.slideHeight*t},e.transitionDuration,e.transitionEasing,function(){for(var e=0;e<t;e++){this.items.canvas.$element.append(this.items.slides.$elements[e])}this.items.canvas.$element.css("top","0");this.items.slides.$elements=s(this.items.slides.selector,this.$element)}.bind(this))}else if(t<0){for(var i=this.items.slides.$elements.length-1;i>=this.items.slides.$elements.length+t;i--){this.items.canvas.$element.prepend(this.items.slides.$elements[i])}this.items.canvas.$element.css("top",e.slideHeight*t+"px");this.items.slides.$elements=s(this.items.slides.selector,this.$element);this.items.canvas.$element.animate({top:"0"},e.transitionDuration,e.transitionEasing)}}}},_create:function(e){var t=this.options;this._setup();this.items={viewport:{selector:'[data-item="viewport"]'},canvas:{selector:'[data-item="canvas"]'},slides:{selector:'[data-item="slide"]'},next:{selector:'[data-to="next"]'},prev:{selector:'[data-to="prev"]'},jumps:{selector:'[data-to]:not([data-to="next"], [data-to="prev"])'}};s.each(this.items,function(e,t){this.items[e].$elements=s(t.selector,this.$element);this.items[e].$element=this.items[e].$elements.length>0?s(this.items[e].$elements[0]):null}.bind(this));this.items.container={$element:this.items.viewport.$element.parent()};if(!this.infinite){s(this.items.slides.$elements[t.currentSlide]).addClass(t.classSelected);if(this.items.jumps.$elements.length>0){s('[data-to="'+t.currentSlide+'"]',this.items.jumps.$elements).addClass(t.classSelected)}}this.$element.addClass(i.fromCamelCase(t.transitionType));this.transitionTypes[t.transitionType].init.bind(this)();this._setupEvents();if(!this.vertical){this.items.viewport.$element.height(t.slideHeight);this.items.canvas.$element.height(t.slideHeight);this.items.slides.$elements.height(t.slideHeight);this.setWidths()}this.$element.addClass(t.classActive);s(this.items.slides.$elements[t.currentSlide]).addClass(t.classSelected);if(this.items.jumps.$elements.length>0){s(this.items.jumps.$elements[t.currentSlide]).addClass(t.classSelected)}if(t.hidePreviousOnFirstSlide&&t.currentSlide>0)this.checkPreviousButton(t.currentSlide);if(t.autoplayDelay>0){this.autoplay()}},_setupEvents:function(){var t=this,i=t.options,e={};e[n+" "+this.items.next.selector]="next";e[n+" "+this.items.prev.selector]="previous";if(!this.infinite){e[n+" "+this.items.jumps.selector]=function(e){t.goto(parseInt(s(e.target).data("to"),10))}}this.items.slides.$elements.on("hover",function(e){t.items.slides.$elements.removeClass(i.classFocus);s(this).addClass(i.classFocus)});if(!this.vertical){this._on(this.$window,{resize:function(e){t.setWidths()}})}if(i.autoplayDelay>0){if(i.autoplayPauseOnHover){s.extend(e,{mouseenter:function(e){if(t.interval){t.pause()}},mouseleave:function(e){if(!t.interval){t.autoplay()}}})}if(i.autoplayPauseOnBlur){this._on(this.$window,{blur:function(e){if(t.interval){t.pause()}},focus:function(e){if(!t.interval){t.autoplay()}}})}}this._on(this.$element,e)},_autoplayNextSlide:function(){var e=this.options;this.showSlide(this.infinite?e.incrementAmount:(e.currentSlide+e.incrementAmount)%this.items.slides.$elements.length)},_updatePushState:function(e){if(history.pushState){history.pushState(null,null,e)}},showSlide:function(e){var t=this.options;this.transitionTypes[t.transitionType].showSlide.bind(this)(e);if(!this.infinite){this.items.slides.$elements.removeClass(t.classSelected);this.items.jumps.$elements.removeClass(t.classSelected);s(this.items.slides.$elements[e]).addClass(t.classSelected);if(this.items.jumps.$elements.length>0){s(this.items.jumps.$elements[e]).addClass(t.classSelected)}t.currentSlide=e}if(t.updatePagination){this._updatePushState(s(this.items.slides.$elements[e]).data(t.pageUrlAttribute))}this._trigger("slidechanged")},next:function(){var e=this.options;this.pause(true);this.showSlide(this.infinite?e.incrementAmount:(e.currentSlide+e.incrementAmount)%this.items.slides.$elements.length);if(e.hidePreviousOnFirstSlide)this.checkPreviousButton(e.currentSlide);this._trigger("next")},previous:function(){var e=this.options;this.pause(true);this.showSlide(this.infinite?-e.incrementAmount:(e.currentSlide+this.items.slides.$elements.length-e.incrementAmount)%this.items.slides.$elements.length);if(e.hidePreviousOnFirstSlide)this.checkPreviousButton(e.currentSlide);this._trigger("previous")},goto:function(e){var t=this.options;this.pause(true);this.showSlide(e);if(t.hidePreviousOnFirstSlide)this.checkPreviousButton(e);this._trigger("goto")},autoplay:function(){var e=this.options;if(e.autoplayDelay>0){this.interval=setInterval(this._autoplayNextSlide.bind(this),e.autoplayDelay);this._trigger("play")}},pause:function(e){var t=this.options;clearInterval(this.interval);this.interval=null;this._trigger("pause");if(e){t.autoplayDelay=0;this._trigger("stop")}},setWidths:function(){var e=this.options;this.slideWidth=e.slideWidth?parseInt(e.slideWidth):this.items.container.$element.width()/this.options.numOfVisibleSlides;this.items.slides.$elements.width(this.slideWidth);this.items.canvas.$element.width(this.slideWidth*this.items.slides.$elements.length);this.items.canvas.$element.css("left",-this.slideWidth*e.currentSlide)},checkPreviousButton:function(e){if(e===0){s(this.items.prev.selector).css("visibility","hidden")}else{s(this.items.prev.selector).css("visibility","visible")}}})});