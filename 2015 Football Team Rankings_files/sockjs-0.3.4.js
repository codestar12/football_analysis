var JSON;JSON||(JSON={}),function(){function str(e,t){var n,r,o,i,a=gap,u,s=t[e];s&&typeof s=="object"&&typeof s.toJSON=="function"&&(s=s.toJSON(e)),typeof rep=="function"&&(s=rep.call(t,e,s));switch(typeof s){case"string":return quote(s);case"number":return isFinite(s)?String(s):"null";case"boolean":case"null":return String(s);case"object":if(!s)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(s)==="[object Array]"){i=s.length;for(n=0;n<i;n+=1)u[n]=str(n,s)||"null";o=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+a+"]":"["+u.join(",")+"]",gap=a;return o}if(rep&&typeof rep=="object"){i=rep.length;for(n=0;n<i;n+=1)typeof rep[n]=="string"&&(r=rep[n],o=str(r,s),o&&u.push(quote(r)+(gap?": ":":")+o))}else for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(o=str(r,s),o&&u.push(quote(r)+(gap?": ":":")+o));o=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+a+"}":"{"+u.join(",")+"}",gap=a;return o}}function quote(e){escapable.lastIndex=0;return escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function f(e){return e<10?"0"+e:e}"use strict",typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,o=e[t];if(o&&typeof o=="object")for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(r=walk(o,n),r!==undefined?o[n]=r:delete o[n]);return reviver.call(e,t,o)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver=="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")})}();SockJS=function(){var c=document;var l=window;var d={};var e=function(){};e.prototype.addEventListener=function(e,t){if(!this._listeners){this._listeners={}}if(!(e in this._listeners)){this._listeners[e]=[]}var n=this._listeners[e];if(d.arrIndexOf(n,t)===-1){n.push(t)}return};e.prototype.removeEventListener=function(e,t){if(!(this._listeners&&e in this._listeners)){return}var n=this._listeners[e];var r=d.arrIndexOf(n,t);if(r!==-1){if(n.length>1){this._listeners[e]=n.slice(0,r).concat(n.slice(r+1))}else{delete this._listeners[e]}return}return};e.prototype.dispatchEvent=function(e){var t=e.type;var n=Array.prototype.slice.call(arguments,0);if(this["on"+t]){this["on"+t].apply(this,n)}if(this._listeners&&t in this._listeners){for(var r=0;r<this._listeners[t].length;r++){this._listeners[t][r].apply(this,n)}}};var u=function(e,t){this.type=e;if(typeof t!=="undefined"){for(var n in t){if(!t.hasOwnProperty(n))continue;this[n]=t[n]}}};u.prototype.toString=function(){var e=[];for(var t in this){if(!this.hasOwnProperty(t))continue;var n=this[t];if(typeof n==="function")n="[function]";e.push(t+"="+n)}return"SimpleEvent("+e.join(", ")+")"};var t=function(e){var t=this;t._events=e||[];t._listeners={}};t.prototype.emit=function(e){var t=this;t._verifyType(e);if(t._nuked)return;var n=Array.prototype.slice.call(arguments,1);if(t["on"+e]){t["on"+e].apply(t,n)}if(e in t._listeners){for(var r=0;r<t._listeners[e].length;r++){t._listeners[e][r].apply(t,n)}}};t.prototype.on=function(e,t){var n=this;n._verifyType(e);if(n._nuked)return;if(!(e in n._listeners)){n._listeners[e]=[]}n._listeners[e].push(t)};t.prototype._verifyType=function(e){var t=this;if(d.arrIndexOf(t._events,e)===-1){d.log("Event "+JSON.stringify(e)+" not listed "+JSON.stringify(t._events)+" in "+t)}};t.prototype.nuke=function(){var e=this;e._nuked=true;for(var t=0;t<e._events.length;t++){delete e[e._events[t]]}e._listeners={}};var o="abcdefghijklmnopqrstuvwxyz0123456789_";d.random_string=function(e,t){t=t||o.length;var n,r=[];for(n=0;n<e;n++){r.push(o.substr(Math.floor(Math.random()*t),1))}return r.join("")};d.random_number=function(e){return Math.floor(Math.random()*e)};d.random_number_string=function(e){var t=(""+(e-1)).length;var n=Array(t+1).join("0");return(n+d.random_number(e)).slice(-t)};d.getOrigin=function(e){e+="/";var t=e.split("/").slice(0,3);return t.join("/")};d.isSameOriginUrl=function(e,t){if(!t)t=l.location.href;return e.split("/").slice(0,3).join("/")===t.split("/").slice(0,3).join("/")};d.getParentDomain=function(e){if(/^[0-9.]*$/.test(e))return e;if(/^\[/.test(e))return e;if(!/[.]/.test(e))return e;var t=e.split(".").slice(1);return t.join(".")};d.objectExtend=function(e,t){for(var n in t){if(t.hasOwnProperty(n)){e[n]=t[n]}}return e};var p="_jp";d.polluteGlobalNamespace=function(){if(!(p in l)){l[p]={}}};d.closeFrame=function(e,t){return"c"+JSON.stringify([e,t])};d.userSetCode=function(e){return e===1e3||e>=3e3&&e<=4999};d.countRTO=function(e){var t;if(e>100){t=3*e}else{t=e+200}return t};d.log=function(){if(l.console&&console.log&&console.log.apply){console.log.apply(console,arguments)}};d.bind=function(e,t){if(e.bind){return e.bind(t)}else{return function(){return e.apply(t,arguments)}}};d.flatUrl=function(e){return e.indexOf("?")===-1&&e.indexOf("#")===-1};d.amendUrl=function(e){var t=c.location;if(!e){throw new Error("Wrong url for SockJS")}if(!d.flatUrl(e)){throw new Error("Only basic urls are supported in SockJS")}if(e.indexOf("//")===0){e=t.protocol+e}if(e.indexOf("/")===0){e=t.protocol+"//"+t.host+e}e=e.replace(/[/]+$/,"");return e};d.arrIndexOf=function(e,t){for(var n=0;n<e.length;n++){if(e[n]===t){return n}}return-1};d.arrSkip=function(e,t){var n=d.arrIndexOf(e,t);if(n===-1){return e.slice()}else{var r=e.slice(0,n);return r.concat(e.slice(n+1))}};d.isArray=Array.isArray||function(e){return{}.toString.call(e).indexOf("Array")>=0};d.delay=function(e,t){if(typeof e==="function"){t=e;e=0}return setTimeout(t,e)};var n=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,r={"\0":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","\t":"\\t","\n":"\\n","\v":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","":"\\u0080","":"\\u0081","":"\\u0082","":"\\u0083","":"\\u0084","":"\\u0085","":"\\u0086","":"\\u0087","":"\\u0088","":"\\u0089","":"\\u008a","":"\\u008b","":"\\u008c","":"\\u008d","":"\\u008e","":"\\u008f","":"\\u0090","":"\\u0091","":"\\u0092","":"\\u0093","":"\\u0094","":"\\u0095","":"\\u0096","":"\\u0097","":"\\u0098","":"\\u0099","":"\\u009a","":"\\u009b","":"\\u009c","":"\\u009d","":"\\u009e","":"\\u009f","­":"\\u00ad","؀":"\\u0600","؁":"\\u0601","؂":"\\u0602","؃":"\\u0603","؄":"\\u0604","܏":"\\u070f","឴":"\\u17b4","឵":"\\u17b5","‌":"\\u200c","‍":"\\u200d","‎":"\\u200e","‏":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","‪":"\\u202a","‫":"\\u202b","‬":"\\u202c","‭":"\\u202d","‮":"\\u202e"," ":"\\u202f","⁠":"\\u2060","⁡":"\\u2061","⁢":"\\u2062","⁣":"\\u2063","⁤":"\\u2064","⁥":"\\u2065","⁦":"\\u2066","⁧":"\\u2067","⁨":"\\u2068","⁩":"\\u2069","⁪":"\\u206a","⁫":"\\u206b","⁬":"\\u206c","⁭":"\\u206d","⁮":"\\u206e","⁯":"\\u206f","\ufeff":"\\ufeff","￰":"\\ufff0","￱":"\\ufff1","￲":"\\ufff2","￳":"\\ufff3","￴":"\\ufff4","￵":"\\ufff5","￶":"\\ufff6","￷":"\\ufff7","￸":"\\ufff8","￹":"\\ufff9","￺":"\\ufffa","￻":"\\ufffb","￼":"\\ufffc","�":"\\ufffd","￾":"\\ufffe","￿":"\\uffff"};var i=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,a;var s=JSON&&JSON.stringify||function(e){n.lastIndex=0;if(n.test(e)){e=e.replace(n,function(e){return r[e]})}return'"'+e+'"'};var f=function(e){var t;var n={};var r=[];for(t=0;t<65536;t++){r.push(String.fromCharCode(t))}e.lastIndex=0;r.join("").replace(e,function(e){n[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4);return""});e.lastIndex=0;return n};d.quote=function(e){var t=s(e);i.lastIndex=0;if(!i.test(t)){return t}if(!a)a=f(i);return t.replace(i,function(e){return a[e]})};var v=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];d.probeProtocols=function(){var e={};for(var t=0;t<v.length;t++){var n=v[t];e[n]=x[n]&&x[n].enabled()}return e};d.detectProtocols=function(e,t,n){var r={},o=[];if(!t)t=v;for(var i=0;i<t.length;i++){var a=t[i];r[a]=e[a]}var u=function(e){var t=e.shift();if(r[t]){o.push(t)}else{if(e.length>0){u(e)}}};if(n.websocket!==false){u(["websocket"])}if(r["xhr-streaming"]&&!n.null_origin){o.push("xhr-streaming")}else{if(r["xdr-streaming"]&&!n.cookie_needed&&!n.null_origin){o.push("xdr-streaming")}else{u(["iframe-eventsource","iframe-htmlfile"])}}if(r["xhr-polling"]&&!n.null_origin){o.push("xhr-polling")}else{if(r["xdr-polling"]&&!n.cookie_needed&&!n.null_origin){o.push("xdr-polling")}else{u(["iframe-xhr-polling","jsonp-polling"])}}return o};var h="_sockjs_global";d.createHook=function(){var e="a"+d.random_string(8);if(!(h in l)){var t={};l[h]=function(e){if(!(e in t)){t[e]={id:e,del:function(){delete t[e]}}}return t[e]}}return l[h](e)};d.attachMessage=function(e){d.attachEvent("message",e)};d.attachEvent=function(e,t){if(typeof l.addEventListener!=="undefined"){l.addEventListener(e,t,false)}else{c.attachEvent("on"+e,t);l.attachEvent("on"+e,t)}};d.detachMessage=function(e){d.detachEvent("message",e)};d.detachEvent=function(e,t){if(typeof l.addEventListener!=="undefined"){l.removeEventListener(e,t,false)}else{c.detachEvent("on"+e,t);l.detachEvent("on"+e,t)}};var _={};var y=false;var g=function(){for(var e in _){_[e]();delete _[e]}};var m=function(){if(y)return;y=true;g()};d.attachEvent("unload",m);d.unload_add=function(e){var t=d.random_string(8);_[t]=e;if(y){d.delay(g)}return t};d.unload_del=function(e){if(e in _)delete _[e]};d.createIframe=function(e,t){var n=c.createElement("iframe");var r,o;var i=function(){clearTimeout(r);try{n.onload=null}catch(e){}n.onerror=null};var a=function(){if(n){i();setTimeout(function(){if(n){n.parentNode.removeChild(n)}n=null},0);d.unload_del(o)}};var u=function(e){if(n){a();t(e)}};var s=function(e,t){try{if(n&&n.contentWindow){n.contentWindow.postMessage(e,t)}}catch(e){}};n.src=e;n.style.display="none";n.style.position="absolute";n.onerror=function(){u("onerror")};n.onload=function(){clearTimeout(r);r=setTimeout(function(){u("onload timeout")},2e3)};c.body.appendChild(n);r=setTimeout(function(){u("timeout")},15e3);o=d.unload_add(a);return{post:s,cleanup:a,loaded:i}};d.createHtmlfile=function(e,t){var n=new ActiveXObject("htmlfile");var r,o;var i;var a=function(){clearTimeout(r)};var u=function(){if(n){a();d.unload_del(o);i.parentNode.removeChild(i);i=n=null;CollectGarbage()}};var s=function(e){if(n){u();t(e)}};var f=function(e,t){try{if(i&&i.contentWindow){i.contentWindow.postMessage(e,t)}}catch(e){}};n.open();n.write("<html><s"+"cript>"+'document.domain="'+document.domain+'";'+"</s"+"cript></html>");n.close();n.parentWindow[p]=l[p];var c=n.createElement("div");n.body.appendChild(c);i=n.createElement("iframe");c.appendChild(i);i.src=e;r=setTimeout(function(){s("timeout")},15e3);o=d.unload_add(u);return{post:f,cleanup:u,loaded:a}};var b=function(){};b.prototype=new t(["chunk","finish"]);b.prototype._start=function(e,t,n,r){var o=this;try{o.xhr=new XMLHttpRequest}catch(e){}if(!o.xhr){try{o.xhr=new l.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}if(l.ActiveXObject||l.XDomainRequest){t+=(t.indexOf("?")===-1?"?":"&")+"t="+ +new Date}o.unload_ref=d.unload_add(function(){o._cleanup(true)});try{o.xhr.open(e,t,true)}catch(e){o.emit("finish",0,"");o._cleanup();return}if(!r||!r.no_credentials){o.xhr.withCredentials="true"}if(r&&r.headers){for(var i in r.headers){o.xhr.setRequestHeader(i,r.headers[i])}}o.xhr.onreadystatechange=function(){if(o.xhr){var e=o.xhr;switch(e.readyState){case 3:try{var t=e.status;var n=e.responseText}catch(e){};if(t===1223)t=204;if(n&&n.length>0){o.emit("chunk",t,n)}break;case 4:var t=e.status;if(t===1223)t=204;o.emit("finish",t,e.responseText);o._cleanup(false);break}}};o.xhr.send(n)};b.prototype._cleanup=function(e){var t=this;if(!t.xhr)return;d.unload_del(t.unload_ref);t.xhr.onreadystatechange=function(){};if(e){try{t.xhr.abort()}catch(e){}}t.unload_ref=t.xhr=null};b.prototype.close=function(){var e=this;e.nuke();e._cleanup(true)};var w=d.XHRCorsObject=function(){var e=this,t=arguments;d.delay(function(){e._start.apply(e,t)})};w.prototype=new b;var O=d.XHRLocalObject=function(e,t,n){var r=this;d.delay(function(){r._start(e,t,n,{no_credentials:true})})};O.prototype=new b;var S=d.XDRObject=function(e,t,n){var r=this;d.delay(function(){r._start(e,t,n)})};S.prototype=new t(["chunk","finish"]);S.prototype._start=function(e,t,n){var r=this;var o=new XDomainRequest;t+=(t.indexOf("?")===-1?"?":"&")+"t="+ +new Date;var i=o.ontimeout=o.onerror=function(){r.emit("finish",0,"");r._cleanup(false)};o.onprogress=function(){r.emit("chunk",200,o.responseText)};o.onload=function(){r.emit("finish",200,o.responseText);r._cleanup(false)};r.xdr=o;r.unload_ref=d.unload_add(function(){r._cleanup(true)});try{r.xdr.open(e,t);r.xdr.send(n)}catch(e){i()}};S.prototype._cleanup=function(e){var t=this;if(!t.xdr)return;d.unload_del(t.unload_ref);t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null;if(e){try{t.xdr.abort()}catch(e){}}t.unload_ref=t.xdr=null};S.prototype.close=function(){var e=this;e.nuke();e._cleanup(true)};d.isXHRCorsCapable=function(){if(l.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest){return 1}if(l.XDomainRequest&&c.domain){return 2}if(L.enabled()){return 3}return 4};var x=function(e,t,n){if(this===l){return new x(e,t,n)}var r=this,o;r._options={devel:false,debug:false,protocols_whitelist:[],info:undefined,rtt:undefined};if(n){d.objectExtend(r._options,n)}r._base_url=d.amendUrl(e);r._server=r._options.server||d.random_number_string(1e3);if(r._options.protocols_whitelist&&r._options.protocols_whitelist.length){o=r._options.protocols_whitelist}else{if(typeof t==="string"&&t.length>0){o=[t]}else if(d.isArray(t)){o=t}else{o=null}if(o){r._debug('Deprecated API: Use "protocols_whitelist" option '+"instead of supplying protocol list as a second "+"parameter to SockJS constructor.")}}r._protocols=[];r.protocol=null;r.readyState=x.CONNECTING;r._ir=F(r._base_url);r._ir.onfinish=function(e,t){r._ir=null;if(e){if(r._options.info){e=d.objectExtend(e,r._options.info)}if(r._options.rtt){t=r._options.rtt}r._applyInfo(e,t,o);r._didClose()}else{r._didClose(1002,"Can't connect to server",true)}}};x.prototype=new e;x.version="0.3.4";x.CONNECTING=0;x.OPEN=1;x.CLOSING=2;x.CLOSED=3;x.prototype._debug=function(){if(this._options.debug)d.log.apply(d,arguments)};x.prototype._dispatchOpen=function(){var e=this;if(e.readyState===x.CONNECTING){if(e._transport_tref){clearTimeout(e._transport_tref);e._transport_tref=null}e.readyState=x.OPEN;e.dispatchEvent(new u("open"))}else{e._didClose(1006,"Server lost session")}};x.prototype._dispatchMessage=function(e){var t=this;if(t.readyState!==x.OPEN)return;t.dispatchEvent(new u("message",{data:e}))};x.prototype._dispatchHeartbeat=function(e){var t=this;if(t.readyState!==x.OPEN)return;t.dispatchEvent(new u("heartbeat",{}))};x.prototype._didClose=function(e,t,n){var r=this;if(r.readyState!==x.CONNECTING&&r.readyState!==x.OPEN&&r.readyState!==x.CLOSING)throw new Error("INVALID_STATE_ERR");if(r._ir){r._ir.nuke();r._ir=null}if(r._transport){r._transport.doCleanup();r._transport=null}var o=new u("close",{code:e,reason:t,wasClean:d.userSetCode(e)});if(!d.userSetCode(e)&&r.readyState===x.CONNECTING&&!n){if(r._try_next_protocol(o)){return}o=new u("close",{code:2e3,reason:"All transports failed",wasClean:false,last_event:o})}r.readyState=x.CLOSED;d.delay(function(){r.dispatchEvent(o)})};x.prototype._didMessage=function(e){var t=this;var n=e.slice(0,1);switch(n){case"o":t._dispatchOpen();break;case"a":var r=JSON.parse(e.slice(1)||"[]");for(var o=0;o<r.length;o++){t._dispatchMessage(r[o])}break;case"m":var r=JSON.parse(e.slice(1)||"null");t._dispatchMessage(r);break;case"c":var r=JSON.parse(e.slice(1)||"[]");t._didClose(r[0],r[1]);break;case"h":t._dispatchHeartbeat();break}};x.prototype._try_next_protocol=function(e){var t=this;if(t.protocol){t._debug("Closed transport:",t.protocol,""+e);t.protocol=null}if(t._transport_tref){clearTimeout(t._transport_tref);t._transport_tref=null}while(1){var n=t.protocol=t._protocols.shift();if(!n){return false}if(x[n]&&x[n].need_body===true&&(!c.body||typeof c.readyState!=="undefined"&&c.readyState!=="complete")){t._protocols.unshift(n);t.protocol="waiting-for-load";d.attachEvent("load",function(){t._try_next_protocol()});return true}if(!x[n]||!x[n].enabled(t._options)){t._debug("Skipping transport:",n)}else{var r=x[n].roundTrips||1;var o=(t._options.rto||0)*r||5e3;t._transport_tref=d.delay(o,function(){if(t.readyState===x.CONNECTING){t._didClose(2007,"Transport timeouted")}});var i=d.random_string(8);var a=t._base_url+"/"+t._server+"/"+i;t._debug("Opening transport:",n," url:"+a," RTO:"+t._options.rto);t._transport=new x[n](t,a,t._base_url);return true}}};x.prototype.close=function(e,t){var n=this;if(e&&!d.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");if(n.readyState!==x.CONNECTING&&n.readyState!==x.OPEN){return false}n.readyState=x.CLOSING;n._didClose(e||1e3,t||"Normal closure");return true};x.prototype.send=function(e){var t=this;if(t.readyState===x.CONNECTING)throw new Error("INVALID_STATE_ERR");if(t.readyState===x.OPEN){t._transport.doSend(d.quote(""+e))}return true};x.prototype._applyInfo=function(e,t,n){var r=this;r._options.info=e;r._options.rtt=t;r._options.rto=d.countRTO(t);r._options.info.null_origin=!c.domain;var o=d.probeProtocols();r._protocols=d.detectProtocols(o,n,e)};var C=x.websocket=function(e,t){var n=this;var r=t+"/websocket";if(r.slice(0,5)==="https"){r="wss"+r.slice(5)}else{r="ws"+r.slice(4)}n.ri=e;n.url=r;var o=l.WebSocket||l.MozWebSocket;n.ws=new o(n.url);n.ws.onmessage=function(e){n.ri._didMessage(e.data)};n.unload_ref=d.unload_add(function(){n.ws.close()});n.ws.onclose=function(){n.ri._didMessage(d.closeFrame(1006,"WebSocket connection broken"))}};C.prototype.doSend=function(e){this.ws.send("["+e+"]")};C.prototype.doCleanup=function(){var e=this;var t=e.ws;if(t){t.onmessage=t.onclose=null;t.close();d.unload_del(e.unload_ref);e.unload_ref=e.ri=e.ws=null}};C.enabled=function(){return!!(l.WebSocket||l.MozWebSocket)};C.roundTrips=2;var N=function(){};N.prototype.send_constructor=function(e){var t=this;t.send_buffer=[];t.sender=e};N.prototype.doSend=function(e){var t=this;t.send_buffer.push(e);if(!t.send_stop){t.send_schedule()}};N.prototype.send_schedule_wait=function(){var e=this;var t;e.send_stop=function(){e.send_stop=null;clearTimeout(t)};t=d.delay(25,function(){e.send_stop=null;e.send_schedule()})};N.prototype.send_schedule=function(){var n=this;if(n.send_buffer.length>0){var e="["+n.send_buffer.join(",")+"]";n.send_stop=n.sender(n.trans_url,e,function(e,t){n.send_stop=null;if(e===false){n.ri._didClose(1006,"Sending error "+t)}else{n.send_schedule_wait()}});n.send_buffer=[]}};N.prototype.send_destructor=function(){var e=this;if(e._send_stop){e._send_stop()}e._send_stop=null};var E=function(e,t,n){var r=this;if(!("_send_form"in r)){var o=r._send_form=c.createElement("form");var i=r._send_area=c.createElement("textarea");i.name="d";o.style.display="none";o.style.position="absolute";o.method="POST";o.enctype="application/x-www-form-urlencoded";o.acceptCharset="UTF-8";o.appendChild(i);c.body.appendChild(o)}var o=r._send_form;var i=r._send_area;var a="a"+d.random_string(8);o.target=a;o.action=e+"/jsonp_send?i="+a;var u;try{u=c.createElement('<iframe name="'+a+'">')}catch(e){u=c.createElement("iframe");u.name=a}u.id=a;o.appendChild(u);u.style.display="none";try{i.value=t}catch(e){d.log("Your browser is seriously broken. Go home! "+e.message)}o.submit();var s=function(e){if(!u.onerror)return;u.onreadystatechange=u.onerror=u.onload=null;d.delay(500,function(){u.parentNode.removeChild(u);u=null});i.value="";n(true)};u.onerror=u.onload=s;u.onreadystatechange=function(e){if(u.readyState=="complete")s()};return s};var j=function(o){return function(e,t,n){var r=new o("POST",e+"/xhr_send",t);r.onfinish=function(e,t){n(e===200||e===204,"http status "+e)};return function(e){n(false,e)}}};var k=function(e,t){var n;var r=c.createElement("script");var o;var i=function(e){if(o){o.parentNode.removeChild(o);o=null}if(r){clearTimeout(n);r.parentNode.removeChild(r);r.onreadystatechange=r.onerror=r.onload=r.onclick=null;r=null;t(e);t=null}};var a=false;var u=null;r.id="a"+d.random_string(8);r.src=e;r.type="text/javascript";r.charset="UTF-8";r.onerror=function(e){if(!u){u=setTimeout(function(){if(!a){i(d.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))}},1e3)}};r.onload=function(e){i(d.closeFrame(1006,"JSONP script loaded abnormally (onload)"))};r.onreadystatechange=function(e){if(/loaded|closed/.test(r.readyState)){if(r&&r.htmlFor&&r.onclick){a=true;try{r.onclick()}catch(e){}}if(r){i(d.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}}};if(typeof r.async==="undefined"&&c.attachEvent){if(!/opera/i.test(navigator.userAgent)){try{r.htmlFor=r.id;r.event="onclick"}catch(e){}r.async=true}else{o=c.createElement("script");o.text="try{var a = document.getElementById('"+r.id+"'); if(a)a.onerror();}catch(x){};";r.async=o.async=false}}if(typeof r.async!=="undefined"){r.async=true}n=setTimeout(function(){i(d.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var s=c.getElementsByTagName("head")[0];s.insertBefore(r,s.firstChild);if(o){s.insertBefore(o,s.firstChild)}return i};var T=x["jsonp-polling"]=function(e,t){d.polluteGlobalNamespace();var n=this;n.ri=e;n.trans_url=t;n.send_constructor(E);n._schedule_recv()};T.prototype=new N;T.prototype._schedule_recv=function(){var t=this;var e=function(e){t._recv_stop=null;if(e){if(!t._is_closing){t.ri._didMessage(e)}}if(!t._is_closing){t._schedule_recv()}};t._recv_stop=M(t.trans_url+"/jsonp",k,e)};T.enabled=function(){return true};T.need_body=true;T.prototype.doCleanup=function(){var e=this;e._is_closing=true;if(e._recv_stop){e._recv_stop()}e.ri=e._recv_stop=null;e.send_destructor()};var M=function(e,t,n){var r="a"+d.random_string(6);var o=e+"?c="+escape(p+"."+r);var i=0;var a=function(e){switch(i){case 0:delete l[p][r];n(e);break;case 1:n(e);i=2;break;case 2:delete l[p][r];break}};var u=t(o,a);l[p][r]=u;var s=function(){if(l[p][r]){i=1;l[p][r](d.closeFrame(1e3,"JSONP user aborted read"))}};return s};var J=function(){};J.prototype=new N;J.prototype.run=function(e,t,n,r,o){var i=this;i.ri=e;i.trans_url=t;i.send_constructor(j(o));i.poll=new Z(e,r,t+n,o)};J.prototype.doCleanup=function(){var e=this;if(e.poll){e.poll.abort();e.poll=null}};var R=x["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",re,d.XHRCorsObject)};R.prototype=new J;R.enabled=function(){return l.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)};R.roundTrips=2;R.need_body=true;var I=x["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",re,d.XDRObject)};I.prototype=new J;I.enabled=function(){return!!l.XDomainRequest};I.roundTrips=2;var X=x["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",re,d.XHRCorsObject)};X.prototype=new J;X.enabled=R.enabled;X.roundTrips=2;var A=x["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",re,d.XDRObject)};A.prototype=new J;A.enabled=I.enabled;A.roundTrips=2;var L=function(){};L.prototype.i_constructor=function(e,t,n){var r=this;r.ri=e;r.origin=d.getOrigin(n);r.base_url=n;r.trans_url=t;var o=n+"/iframe.html";if(r.ri._options.devel){o+="?t="+ +new Date}r.window_id=d.random_string(8);o+="#"+r.window_id;r.iframeObj=d.createIframe(o,function(e){r.ri._didClose(1006,"Unable to load an iframe ("+e+")")});r.onmessage_cb=d.bind(r.onmessage,r);d.attachMessage(r.onmessage_cb)};L.prototype.doCleanup=function(){var e=this;if(e.iframeObj){d.detachMessage(e.onmessage_cb);try{if(e.iframeObj.iframe.contentWindow){e.postMessage("c")}}catch(e){}e.iframeObj.cleanup();e.iframeObj=null;e.onmessage_cb=e.iframeObj=null}};L.prototype.onmessage=function(e){var t=this;if(e.origin!==t.origin)return;var n=e.data.slice(0,8);var r=e.data.slice(8,9);var o=e.data.slice(9);if(n!==t.window_id)return;switch(r){case"s":t.iframeObj.loaded();t.postMessage("s",JSON.stringify([x.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(o);break}};L.prototype.postMessage=function(e,t){var n=this;n.iframeObj.post(n.window_id+e+(t||""),n.origin)};L.prototype.doSend=function(e){this.postMessage("m",e)};L.enabled=function(){var e=navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Konqueror")!==-1;return(typeof l.postMessage==="function"||typeof l.postMessage==="object")&&!e};var P;var H=function(e,t){if(parent!==l){parent.postMessage(P+e+(t||""),"*")}else{d.log("Can't postMessage, no parent window.",e,t)}};var D=function(){};D.prototype._didClose=function(e,t){H("t",d.closeFrame(e,t))};D.prototype._didMessage=function(e){H("t",e)};D.prototype._doSend=function(e){this._transport.doSend(e)};D.prototype._doCleanup=function(){this._transport.doCleanup()};d.parent_origin=undefined;x.bootstrap_iframe=function(){var f;P=c.location.hash.slice(1);var e=function(e){if(e.source!==parent)return;if(typeof d.parent_origin==="undefined")d.parent_origin=e.origin;if(e.origin!==d.parent_origin)return;var t=e.data.slice(0,8);var n=e.data.slice(8,9);var r=e.data.slice(9);if(t!==P)return;switch(n){case"s":var o=JSON.parse(r);var i=o[0];var a=o[1];var u=o[2];var s=o[3];if(i!==x.version){d.log("Incompatibile SockJS! Main site uses:"+' "'+i+'", the iframe:'+' "'+x.version+'".')}if(!d.flatUrl(u)||!d.flatUrl(s)){d.log("Only basic urls are supported in SockJS");return}if(!d.isSameOriginUrl(u)||!d.isSameOriginUrl(s)){d.log("Can't connect to different domain from within an "+"iframe. ("+JSON.stringify([l.location.href,u,s])+")");return}f=new D;f._transport=new D[a](f,u,s);break;case"m":f._doSend(r);break;case"c":if(f)f._doCleanup();f=null;break}};d.attachMessage(e);H("s")};var U=function(e,t){var n=this;d.delay(function(){n.doXhr(e,t)})};U.prototype=new t(["finish"]);U.prototype.doXhr=function(e,t){var o=this;var i=(new Date).getTime();var n=new t("GET",e+"/info");var a=d.delay(8e3,function(){n.ontimeout()});n.onfinish=function(e,t){clearTimeout(a);a=null;if(e===200){var n=(new Date).getTime()-i;var r=JSON.parse(t);if(typeof r!=="object")r={};o.emit("finish",r,n)}else{o.emit("finish")}};n.ontimeout=function(){n.close();o.emit("finish")}};var q=function(n){var i=this;var e=function(){var o=new L;o.protocol="w-iframe-info-receiver";var e=function(e){if(typeof e==="string"&&e.substr(0,1)==="m"){var t=JSON.parse(e.substr(1));var n=t[0],r=t[1];i.emit("finish",n,r)}else{i.emit("finish")}o.doCleanup();o=null};var t={_options:{},_didClose:e,_didMessage:e};o.i_constructor(t,n,n)};if(!c.body){d.attachEvent("load",e)}else{e()}};q.prototype=new t(["finish"]);var G=function(){var e=this;d.delay(function(){e.emit("finish",{},2e3)})};G.prototype=new t(["finish"]);var F=function(e){if(d.isSameOriginUrl(e)){return new U(e,d.XHRLocalObject)}switch(d.isXHRCorsCapable()){case 1:return new U(e,d.XHRLocalObject);case 2:return new U(e,d.XDRObject);case 3:return new q(e);default:return new G}};var W=D["w-iframe-info-receiver"]=function(n,e,t){var r=new U(t,d.XHRLocalObject);r.onfinish=function(e,t){n._didMessage("m"+JSON.stringify([e,t]));n._didClose()}};W.prototype.doCleanup=function(){};var B=x["iframe-eventsource"]=function(){var e=this;e.protocol="w-iframe-eventsource";e.i_constructor.apply(e,arguments)};B.prototype=new L;B.enabled=function(){return"EventSource"in l&&L.enabled()};B.need_body=true;B.roundTrips=3;var z=D["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",Q,d.XHRLocalObject)};z.prototype=new J;var V=x["iframe-xhr-polling"]=function(){var e=this;e.protocol="w-iframe-xhr-polling";e.i_constructor.apply(e,arguments)};V.prototype=new L;V.enabled=function(){return l.XMLHttpRequest&&L.enabled()};V.need_body=true;V.roundTrips=3;var $=D["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",re,d.XHRLocalObject)};$.prototype=new J;var Y=x["iframe-htmlfile"]=function(){var e=this;e.protocol="w-iframe-htmlfile";e.i_constructor.apply(e,arguments)};Y.prototype=new L;Y.enabled=function(){return L.enabled()};Y.need_body=true;Y.roundTrips=3;var K=D["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",ne,d.XHRLocalObject)};K.prototype=new J;var Z=function(e,t,n,r){var o=this;o.ri=e;o.Receiver=t;o.recv_url=n;o.AjaxObject=r;o._scheduleRecv()};Z.prototype._scheduleRecv=function(){var t=this;var n=t.poll=new t.Receiver(t.recv_url,t.AjaxObject);var r=0;n.onmessage=function(e){r+=1;t.ri._didMessage(e.data)};n.onclose=function(e){t.poll=n=n.onmessage=n.onclose=null;if(!t.poll_is_closing){if(e.reason==="permanent"){t.ri._didClose(1006,"Polling error ("+e.reason+")")}else{t._scheduleRecv()}}}};Z.prototype.abort=function(){var e=this;e.poll_is_closing=true;if(e.poll){e.poll.abort()}};var Q=function(e){var r=this;var o=new EventSource(e);o.onmessage=function(e){r.dispatchEvent(new u("message",{data:unescape(e.data)}))};r.es_close=o.onerror=function(e,t){var n=t?"user":o.readyState!==2?"network":"permanent";r.es_close=o.onmessage=o.onerror=null;o.close();o=null;d.delay(200,function(){r.dispatchEvent(new u("close",{reason:n}))})}};Q.prototype=new e;Q.prototype.abort=function(){var e=this;if(e.es_close){e.es_close({},true)}};var ee;var te=function(){if(ee===undefined){if("ActiveXObject"in l){try{ee=!!new ActiveXObject("htmlfile")}catch(e){}}else{ee=false}}return ee};var ne=function(e){var n=this;d.polluteGlobalNamespace();n.id="a"+d.random_string(6,26);e+=(e.indexOf("?")===-1?"?":"&")+"c="+escape(p+"."+n.id);var t=te()?d.createHtmlfile:d.createIframe;var r;l[p][n.id]={start:function(){r.loaded()},message:function(e){n.dispatchEvent(new u("message",{data:e}))},stop:function(){n.iframe_close({},"network")}};n.iframe_close=function(e,t){r.cleanup();n.iframe_close=r=null;delete l[p][n.id];n.dispatchEvent(new u("close",{reason:t}))};r=t(e,function(e){n.iframe_close({},"permanent")})};ne.prototype=new e;ne.prototype.abort=function(){var e=this;if(e.iframe_close){e.iframe_close({},"user")}};var re=function(e,t){var i=this;var a=0;i.xo=new t("POST",e,null);i.xo.onchunk=function(e,t){if(e!==200)return;while(1){var n=t.slice(a);var r=n.indexOf("\n");if(r===-1)break;a+=r+1;var o=n.slice(0,r);i.dispatchEvent(new u("message",{data:o}))}};i.xo.onfinish=function(e,t){i.xo.onchunk(e,t);i.xo=null;var n=e===200?"network":"permanent";i.dispatchEvent(new u("close",{reason:n}))}};re.prototype=new e;re.prototype.abort=function(){var e=this;if(e.xo){e.xo.close();e.dispatchEvent(new u("close",{reason:"user"}));e.xo=null}};x.getUtils=function(){return d};x.getIframeTransport=function(){return L};return x}();if("_sockjs_onload"in window)setTimeout(_sockjs_onload,1);if(typeof define==="function"&&define.amd){define("sockjs",[],function(){return SockJS})}